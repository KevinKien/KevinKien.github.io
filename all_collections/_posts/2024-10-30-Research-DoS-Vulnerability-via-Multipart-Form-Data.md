---
layout: post
title: Research DoS Vulnerability via multipart/form-data
date: 2024-10-30
categories: ["1-Day-Analysis", "Python"]
---

# Summary

I have read a vulnerability about DoS Vulnerability via multipart/form-data, so to deep understand of vulnerability i will research in the direction build code have vulnerability and poc. About DoS vulnerability, this is vulnerability will causing system disruption, with upload via multipart/data hacker will upload large file to application. System when process large file will inscrease cpu and mem causing system disruption. 

# Scenario 1: DoS via file upload

I have a code run a api for upload file with python

```
from fastapi import FastAPI, File, UploadFile, HTTPException
import uvicorn
import os

app = FastAPI()

UPLOAD_DIR = "./uploads"
os.makedirs(UPLOAD_DIR, exist_ok=True)

@app.post("/upload/")
async def upload_file(file: UploadFile = File(...)):
    # read and save file
    try:
        file_location = os.path.join(UPLOAD_DIR, file.filename)
        with open(file_location, "wb") as buffer:
            buffer.write(await file.read())
        return {"filename": file.filename}
    except Exception as e:
        raise HTTPException(status_code=500, detail="Error saving file")

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)

```

This code allow upload any file and save file to folder "uploads". There aren't any check file size so i can upload file with big size. To perform upload file, i use file with `</dev/urandom`. 

`/dev/urandom` is special file of linux, provide random data unlimited. When read '/dev/urandom' system will generate random bytes. Because this is data unlimited, so curl will continous read data and send data until server is interupted or when server cannot accept any data. 

POC: 

```
curl -X POST http://localhost:8000/upload/ -F 'file=@/dev/urandom'
```

# Scenario 2: DoS via multipart boundry

